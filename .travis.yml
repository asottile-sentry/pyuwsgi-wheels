env:
    global:
        - REPO_DIR=uwsgi
        # Commit from your-project that you want to build
        - BUILD_COMMIT=2.0.19.1
        # pip dependencies to _build_ your project
        - BUILD_DEPENDS=""
        # pip dependencies to _test_ your project.  Include any dependencies
        # that you need, that are also specified in BUILD_DEPENDS, this will be
        # a separate install.
        - TEST_DEPENDS="pytest"
        # Use this to add a pre-release version to the end of the uWSGI version
        # e.g., a4, b1
        - APPEND_VERSION="post0"
        - MB_ML_VER=2010
        # Exclude SSL from the wheel builds
        - UWSGI_PROFILE=pyuwsginossl
        - PLAT=x86_64
        - UNICODE_WIDTH=32
        - secure: jrxNS/BUkpPQ/NZp6OdGEWho9EPeQb58klVXFCHIFS2zw7KelUx+UIC3M3v1DtZCHQSroHGxkYOlHOt38OSgKfkNoxD4z2sS2ld7OEIMoHJeZ9nJ0CAPRT7k1dUfUhjkXIh0DNqw5IfjqzixJKq+l0l2HThLPf9fYmjTqV/5Q72g5PADan8l0hnKM/zR9plYYHQ7qh3ESm2H/VsOjIvVbX+xvb6vBU9gMOW3oh5KEEK0DUfdS8PdJL9FXE5PmJLvmu99699RmOUQbaIhjBz1LiKYwZdzEDhig+bne5b6u+92IqNp7AiS4RgaP0dgWsRuTS4JSBFhDucrAdh2bdMnEeALxyHcw8S+6nCKRENXyTj9q7xJwHIOG0PgYveKhiMWEmvksX41RAtVlmj8AnVJ7045MhUS0jkjaTp6qRzvEPzJshbD1zv9wL6LNm4KRxCQ2cJWLQuWgKDxZCiFIIEu0SNpXRYiVDycNanAcKkUOeneg8dxHqsJylEzG9XIXy99pJTPWwyKRYkmJmH7LKpc2bwM8h2O3iWK28gj3vINeIm5kKjR+NTcIrhUQsqCqaKx0lRAv/qMbmaXWqkfnMW5DSQmaPfViCzOST8u4ZMtG2CyQ3SCsz5/Arib5AAubzb7lHpGc6KAhzu+SHg0tp6Mn1uRVxafYfPGbo2uIQArZIY=
        - secure: WeQm3qTXKK27QOel0NJKVpjEfU88kGN/13sQM/lDpa7FGBuXnmWTLMf7An7GhS76swgU+tjuGpGAbU6HK3pKfUG1Giz9ytoUtjYy4friJJYXdiSy6QPjiBE6m69ExOzN/uXPeooYeKz5Ytt1yocnlSaK0nzXGosqCZdRN4iLBGiy7vDE3oEZXCJyarlLQJV+R7OJavApnVZ+vHEnQZPltsbsGQpxsWuabnbCOzTMZpzkZBHpiX39BtIZUrrPr6I0W7KR76aHMFDjn7vNAM/V4E/i3Xztc6JKZFuvcGdSi2hSGjEQoASKrdJF5QPNSZfh+MB0rG5bAUT2KOFZp+DGgYzxUniTVtsfs1nLz1UptF/MVxML7aR9USqiQwT9/7JELgnjRGHC9NVKXgPakhbWXTIS5RR2Q81DTa6UYPU0TXPZDAylu5lLLmTfjdjTKxWoGtjxcLatZALuG2Gi6wKLRdYpJ9IMcQWUW1ixx5yf3Pl8l28E9WUDPEDLQPo1E70YteXrjhMFS7Ad/8lSLy1UaoRwGW1GbYRcsUobbHbJ5iojsLL7HrLGxu/fZTYAKoFvg3hegpcKI+RsCaVLJnD72sXs+9Z/2pydgAph8dF9F0/vNfpTRSyJyUZJa6bRGrpMmemoAxrZqyXNl8nZlr8tlp/+4/StkXslmG9nTUyIeDA=

language: generic
services: docker
dist: xenial
# osx image that enables building Apple silicon libraries
osx_image: xcode12.2

matrix:
  include:
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.5
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.6
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.7
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.8
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.9
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.5
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.6
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.7
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.8
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.9
        - PLAT="universal2"
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.9
before_install:
    - source multibuild/common_utils.sh
    - source multibuild/travis_steps.sh
    - before_install

install:
    - clean_code $REPO_DIR $BUILD_COMMIT
    - ./patch-uwsgi-packaging.sh $REPO_DIR
    - build_wheel $REPO_DIR $PLAT

script:
    - install_run $PLAT

after_success:
    - pip install awscli
    - |
        aws s3 cp --acl=public-read \
          ${TRAVIS_BUILD_DIR}/wheelhouse/* \
          s3://ll-share-public/pyuwsgi/$(python $REPO_DIR/setup.py --version)/
